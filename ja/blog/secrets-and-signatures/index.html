<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;frame-src platform.twitter.com giscus.app;img-src 'self' data: pub-94e31bf482a74272bb61e9559b598705.r2.dev;media-src 'self' pub-94e31bf482a74272bb61e9559b598705.r2.dev;form-action 'self' buttondown.com formspree.io;connect-src 'self';script-src 'self' platform.twitter.com giscus.app" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://vinidlidoo.github.io name=base><title>
vinidlidoo • 鍵からプロトコルへ：ECDHとECDSA（第2回/全2回）</title><link href=https://vinidlidoo.github.io/img/favicon.png rel=icon type=image/png><link href="https://vinidlidoo.github.io/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://vinidlidoo.github.io/main.css?h=045c365e19a4d50a64bb" rel=stylesheet><link href="https://vinidlidoo.github.io/css/details.css?h=8559b4e109b168c7cfa0" rel=stylesheet><link href="https://vinidlidoo.github.io/css/giscus-fix.css?h=dc895b97fbaf0f0d9908" rel=stylesheet><link href="https://vinidlidoo.github.io/css/newsletter.css?h=c872153c9c367e0bee16" rel=stylesheet><link href="https://vinidlidoo.github.io/css/contact.css?h=572915e83e02eb90c290" rel=stylesheet><link href="https://vinidlidoo.github.io/skins/indigo_ingot.css?h=d429472afbb246441b1a" rel=stylesheet><meta content="light dark" name=color-scheme><meta content=楕円曲線の数学が安全な鍵交換とデジタル署名をどう可能にするか name=description><meta content=楕円曲線の数学が安全な鍵交換とデジタル署名をどう可能にするか property=og:description><meta content=鍵からプロトコルへ：ECDHとECDSA（第2回/全2回） property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale:alternate><link href=https://vinidlidoo.github.io/blog/secrets-and-signatures/ hreflang=en rel=alternate><meta content=en_GB property=og:locale:alternate><link href=https://vinidlidoo.github.io/fr/blog/secrets-and-signatures/ hreflang=fr rel=alternate><meta content=en_GB property=og:locale:alternate><link href=https://vinidlidoo.github.io/ja/blog/secrets-and-signatures/ hreflang=ja rel=alternate><meta content=https://vinidlidoo.github.io/ja/blog/secrets-and-signatures/ property=og:url><meta content=vinidlidoo property=og:site_name><noscript><link href=https://vinidlidoo.github.io/no_js.css rel=stylesheet></noscript><script src=https://vinidlidoo.github.io/js/initializeTheme.min.js></script><script defer src=https://vinidlidoo.github.io/js/themeSwitcher.min.js></script><body><a href=#main-content id=skip-link>Skip to content</a><header><nav class=navbar><div class=nav-title><a class=home-title href=https://vinidlidoo.github.io/ja/>vinidlidoo</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://vinidlidoo.github.io/ja/blog/>blog </a><li><a class="nav-links no-hover-padding" href=https://vinidlidoo.github.io/ja/tags/>タグ </a><li><a class="nav-links no-hover-padding" href=https://vinidlidoo.github.io/ja/contact/>連絡先 </a><li class=menu-icons-container><ul class=menu-icons-group><li class=language-switcher><details class=dropdown><summary aria-label="Language selection" title="Language selection" aria-haspopup=true role=button><div class=language-switcher-icon></div></summary> <div class=dropdown-content role=menu>日本語<a aria-label=English href=https://vinidlidoo.github.io/blog/secrets-and-signatures/ lang=en role=menuitem>English</a><a aria-label=Français href=https://vinidlidoo.github.io/fr/blog/secrets-and-signatures/ lang=fr role=menuitem>Français</a></div></details><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></ul></div></nav></header><div class=content id=main-content><main><article class=h-entry><h1 class="p-name article-title">鍵からプロトコルへ：ECDHとECDSA（第2回/全2回）</h1><a class="u-url u-uid" href=https://vinidlidoo.github.io/ja/blog/secrets-and-signatures/></a><ul class=meta><span class="hidden p-author h-card"> <a class=u-url href=https://vinidlidoo.github.io rel=author title=Vincent>Vincent</a> </span><li><time class=dt-published datetime=2026-01-19>19th Jan 2026</time><li title="1687 words"><span aria-hidden=true class=separator>•</span>9 min read<li class=tag><span aria-hidden=true class=separator>•</span>タグ: <li class=tag><a class=p-category href=https://vinidlidoo.github.io/ja/tags/crypto/>crypto</a>, <li class=tag><a class=p-category href=https://vinidlidoo.github.io/ja/tags/math/>math</a></ul><p class=p-summary hidden>楕円曲線の数学が安全な鍵交換とデジタル署名をどう可能にするか<section class="e-content body"><p><img alt=鍵からプロトコルへ src=/img/keys-to-protocols.webp><p><a href=https://vinidlidoo.github.io/ja/blog/math-behind-private-key/>第1回</a>では、必要な道具を組み立てた。体、群、楕円曲線、そして離散対数問題（DLP）だ。鍵ペアで締めくくった。秘密の整数を選び（あちらでは $n$ と呼んだが、標準的な暗号表記に合わせてここでは $d$ を使う）、次を計算する。<p>$$Q = dG$$<p>$Q$ が公開鍵、$d$ が秘密鍵だ。順方向は高速だが、$Q$ から $d$ を復元するにはDLPを解く必要があり、これは実行不可能だ。<p>この記事では、この非対称性が異なる問題を解決する2つのプロトコルをどう可能にするかを示す。共有鍵を確立するための<strong>ECDH</strong>と、デジタル署名のための<strong>ECDSA</strong>だ。<h2 id=ecdh-gong-you-jian>ECDH：共有鍵</h2><h3 id=wen-ti>問題</h3><p>AliceはBobに秘密のメッセージを送りたい。<strong>暗号化</strong>はメッセージを暗号文に変換し、<strong>復号</strong>はその逆を行う。<p><strong>共通鍵暗号</strong>は両方の操作に1つの鍵を使う。高速だが、ブートストラップ問題がある。Aliceはどうやってその鍵をBobに送るのか。メッセージと同じチャネルで送れば、盗聴者が両方を傍受する。鍵を送るための安全なチャネルが必要だが、それはまさに作ろうとしているものだ。鶏と卵。<p><strong>公開鍵暗号</strong>はこれを解決できる。誰でもBobの公開鍵で暗号化できるが、Bobの秘密鍵だけが復号できる。秘密がネットワーク上を流れない。代償は？公開鍵の操作には計算コストの高い演算（点の乗算、モジュラー累乗）が必要だが、共通鍵暗号は単純なビット演算を使う。複雑さの差は約1000倍だ。<p>解決策は<strong>ハイブリッドアプローチ</strong>だ。公開鍵暗号を1回使って共有鍵を確立し、実際のメッセージには共通鍵に切り替える。これがまさにECDHの役割だ。<h3 id=purotokoru>プロトコル</h3><p><strong>楕円曲線ディフィー・ヘルマン鍵共有</strong>は、2者が公開チャネル上で共有鍵を導出できるようにする。<ol><li>Aliceは秘密の整数 $a$ を選び、$A = aG$ を公開する<li>Bobは秘密の整数 $b$ を選び、$B = bG$ を公開する<li>Aliceは $S = aB = a(bG) = abG$ を計算する<li>Bobは $S = bA = b(aG) = abG$ を計算する</ol><p>両者は $a$ も $b$ も送信せずに同じ点 $S$ に到達する。なぜ機能するのか。$a(bG) = (ab)G = b(aG)$ だからだ。この可換性は曲線の特別な性質ではなく、整数の乗法に由来する。<p>なぜ安全なのか。盗聴者は $A$、$B$、$G$ を見るが、これらから $abG$ を計算するには $a$ か $b$ を復元するためにDLPを解く必要がある。それは第1回で確立した困難な方向だ。<p>その後の流れ：AliceとBobは $S$ のx座標をハッシュして共通鍵を導出し、AES（共通鍵暗号の標準規格）のような暗号方式でそれを使う。ECDH自体は何も暗号化しない。共通鍵暗号を可能にする共有鍵をブートストラップするだけだ。<sup class=footnote-reference id=fr-1-1><a href=#fn-1>1</a></sup><p>最近の鍵でPGPやGPGを使ったことがあれば、これを使っている。ハイブリッド構造は同じだ。ECDHがセッション鍵を確立し、AESがメッセージを暗号化する。<h2 id=ecdsa-dezitarushu-ming>ECDSA：デジタル署名</h2><p>ECDHは機密性を解決する。<strong>ECDSA</strong>（楕円曲線DSA）は別の問題、すなわち真正性を解決する。<p>Ethereumのトランザクションを考えよう。公開でブロードキャストされる。機密性が目的ではない。ネットワークはアカウント所有者が実際にトランザクションを承認したことを検証する必要がある。<strong>デジタル署名</strong>は秘密鍵 $d$ を知っていることを明かさずに証明し、その証明を特定のメッセージに紐づける。<h3 id=shu-ming>署名</h3><p>秘密鍵 $d$ でメッセージ $m$ に署名するには、<ol><li>メッセージをハッシュ：$z = H(m)$（$H$ はSHA-256のようなハッシュ関数）<li>ランダムな整数 $k$（ノンス）を選ぶ<li>$R = kG$ を計算し、x座標を $r$ として抽出<li>以下を計算する（$n$ は曲線の位数）。</ol><p>$$s = k^{-1}(z + rd) \mod n$$<p>署名はペア $(r, s)$ だ。<h3 id=jian-zheng>検証</h3><p>メッセージ $m$、署名 $(r, s)$、公開鍵 $Q$ が与えられたとき、<ol><li>$z = H(m)$ を計算<li>$u_1 = zs^{-1} \mod n$ と $u_2 = rs^{-1} \mod n$ を計算<li>$P = u_1 G + u_2 Q$ を計算<li>$P$ のx座標が $r$ に等しければ署名は有効</ol><h3 id=nazejian-zheng-gaji-neng-surunoka>なぜ検証が機能するのか</h3><p>検証者は $k$ も $d$ も知らずに $R$ を再構成する。その代数的な仕組みは以下の通りだ。<p>$$P = u_1 G + u_2 Q = zs^{-1}G + rs^{-1}Q$$<p>$Q = dG$ なので、<p>$$P = zs^{-1}G + rs^{-1}dG = s^{-1}(z + rd)G$$<p>署名の式より $s = k^{-1}(z + rd)$ なので、$s^{-1} = k/(z + rd)$。代入すると、<p>$$P = \frac{k}{z + rd}(z + rd)G = kG = R$$<p>$P$ のx座標が $r$ に等しいのは、まさに署名者が $d$ を知っていたときだ。<h3 id=nonsu>ノンス</h3><p>ランダム値 $k$ は真にランダムで、<strong>決して再利用してはならない</strong>。同じ $k$ で2つの異なるメッセージに署名すると、攻撃者は代数的に秘密鍵 $d$ を復元できる。これは理論上の話ではない。ソニーのPlayStation 3のコード署名は、定数 $k$ を使っていたため<a href=https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm#Security>2010年に破られた</a>。攻撃者は秘密鍵を抽出し、任意のコードに署名できるようになった。<h2 id=matome>まとめ</h2><p>1つの楕円曲線、1つの困難な問題、2つのプロトコル。<p>ECDHは機密性をもたらす。2者が公開チャネル上で共有鍵を導出し、それを共通鍵暗号に使う。ECDSAは真正性をもたらす。秘密鍵を明かさずに、何かを承認したことを証明できる。<p>これは第1回の抽象的な群論が単なるエレガントな数学ではないことを示している。暗号化されたメッセージ、暗号通貨のトランザクション、そしてインターネットのインフラの多くを守る基盤なのだ。<hr><section class=footnotes><ol class=footnotes-list><li id=fn-1><p>2者間ではうまく機能する。グループチャットはより難しい。単純なアプローチでは $N$ 人の参加者に対して $\binom{N}{2} = \frac{N(N-1)}{2}$ 回の一対一の鍵交換が必要になる。実際のメッセージングアプリは、この二次関数的な増加を避けるためにより洗練されたプロトコルを使っている。 <a href=#fr-1-1>↩</a></p></ol></section></section><p class=credit><em>この記事は<a href=https://claude.ai>Claude</a>と協力して執筆しました。</em><form action=https://buttondown.com/api/emails/embed-subscribe/vinidlidoo class=embeddable-buttondown-form method=post target=_blank><label for=bd-email>新着記事の通知はこちらから。</label><input id=bd-email name=email placeholder=your@email.com type=email><input type=submit value=登録></form></article></main><link href=https://vinidlidoo.github.io/katex.min.css rel=stylesheet><script defer src=https://vinidlidoo.github.io/js/katex.min.js></script><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://vinidlidoo.github.io/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/vinidlidoo> <img alt=github loading=lazy src=https://vinidlidoo.github.io/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://x.com/vinidlidoo> <img alt=x loading=lazy src=https://vinidlidoo.github.io/social_icons/x.svg title=x> </a></ul></nav><nav class=nav-navs></nav><div class=credits><small> <p><p>© 2026 Vincent Ethier</p> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section></footer>